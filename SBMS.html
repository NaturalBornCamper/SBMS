<!DOCTYPE html>
<html>
<head>
    <!--
        Background quadrillé bleu semi invisible (voir screenshots)
        panels semi transparents avec bordure plus foncés et bouts arrondis + onglet pour titre
        Son menu system shock 2?
        animated en bas des panneaux. Regarder panneaux.jpg dans inspiration, faire bouger les points de gauche à droite (tester si lag avant, pendant regénération)

        panneaux comme dans panneaux.jpg
         barre de titre pareille
         lignes comme une règle dedans
        background panneaux comme dans advancedui__status_screen_by_z_design
        Titres avec autres boites comme "Processor Usage" "1" "3" dans futuristic-computer-screen-looping-animation_spkp1vjf__F0000

        Spinners
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948651
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948350
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948434
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948451

        Interfaces
        https://www.dreamstime.com/futuristic-user-menu-interface-hud-abstract-background-stock-illustration-image66155789
        https://www.dreamstime.com/stock-illustration-space-game-asset-vector-elements-strategy-video-image70671245
        https://www.dreamstime.com/stock-illustration-space-game-asset-vector-elements-video-image58652427

        Border
        https://www.w3.org/TR/css-backgrounds-3/#border-images
        * https://csscreator.com/content/border-image
        https://css-tricks.com/understanding-border-image/
        generators
            http://border-image.com/#%7B%22src%22%3A%22page-store%3A%2F%2F3%22%2C%22linkBorder%22%3Atrue%2C%22borderWidth%22%3A%5B0%2C0%2C0%2C0%5D%2C%22imageOffset%22%3A%5B219%2C851%2C180%2C712%5D%2C%22fill%22%3Afalse%2C%22setRepat%22%3Afalse%2C%22repeat%22%3A%5B%22repeat%22%2C%22repeat%22%5D%2C%22scaleFactor%22%3A0.40429564118761846%2C%22setRepeat%22%3Atrue%7D

        Interface new
            https://www.google.ca/search?q=dead+space+menu&source=lnms&tbm=isch&sa=X&ved=0ahUKEwizyqOK2YbbAhUmh-AKHfMcBZwQ_AUICigB#imgrc=D0OHQK6iLKsLCM:
            https://www.google.ca/search?biw=1920&bih=900&tbm=isch&sa=1&ei=4kj6WonnF_Ke_Qb_3omIDA&q=crysis+menu&oq=crysis+menu&gs_l=img.3..0j0i7i30k1j0i24k1.84543.85250.0.85387.6.6.0.0.0.0.118.600.4j2.6.0....0...1c.1.64.img..0.6.591....0.jspvjYNa5O8#imgrc=16RVYtmezc6XlM:

        GENERAL
            mouse pointer
            background dans chaque panneau, genre un outline d'une batterie
        MAIN SCREEN (LEFT)
            Battery
                battery meter with color changing according to level
            Cells
                All the meters with colors changing according to level
            Info
                Add
                    Date + heure plus secondes plus GMT
                Type: 1
                Cap: 200Ah
                Status: 20480
                SBMS Temp Int: 34.1℃
                    avec thermomètre
                Ext: -45.0℃
                    avec thermomètre
                BattVoltage 13.357 V
                Cell Δ 7 mV
                status lights
                    PV1 & PV2
                    battery
                    load
                buttons
                    Save log
                    Reset log
                    Add
                        rollover sur boutons "save log"
                        toggle sound
        GRAPH SCREEN (Right)
            Statistics
            time graphs
                lignes horizontales 25% 50% 75%
                À droite graph, fan/turbine/etc qui tourne vitesse de la valeur du graph (ou valeur moyenne)
                    plein de lignes horizontales semi-transparentes par dessus fan, un peu comme si c'était une télé?


        TODO
            value red battery (ex 0, or 40)
            update data doit aussi updater load/battery/pvr1/pvr2 (activer/désactiver LED)
            mettre LEDs plus bright?
            Meter cells même style que la grosse batterie
            LEDs temperature, allumées avec température min et max réglables
    -->
    <title>ElectroDacus</title>
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <!--<meta http-equiv='refresh' content='3'>-->
    <link rel="stylesheet" href="SBMS.css"/>
    <link rel="stylesheet" href="marco.css"/>
    <link rel="icon" type="image/png" href="favicon.png"/>
    <style media='screen' type='text/css'></style>
    <script language="JavaScript" type="application/javascript" src="jquery-3.3.1.min.js"></script>
    <script language="JavaScript" type="application/javascript" src="all.js"></script>
</head>
<body>
<!--<img class="image" src="http://i.stack.imgur.com/pC1Tv.jpg" alt="" width="120" height="120">-->

<div2 style='display: none;' id='id'></div2>


<div id="leftPanel">
    <div class="test2">
        <span class="section-title">Info</span>
        <div id="first">
            <div class="infoBar">
                <span id="infoBarTitle1" class="infoBarTitle"></span>
                <span id="infoBarValue1" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle2" class="infoBarTitle"></span>
                <span id="infoBarValue2" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle3" class="infoBarTitle"></span>
                <span id="infoBarValue3" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle4" class="infoBarTitle"></span>
                <span id="infoBarValue4" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle5" class="infoBarTitle"></span>
                <span id="infoBarValue5" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle6" class="infoBarTitle"></span>
                <span id="infoBarValue6" class="infoBarValue"></span>
            </div>
            <div class="infoBar">
                <span id="infoBarTitle7" class="infoBarTitle"></span>
                <span id="infoBarValue7" class="infoBarValue"></span>
            </div>
            <div2 style='left:5px;top:92px;color:#a99;line-height: 25px;' id='d12'></div2>
        </div>
    </div>
    <div class="test2">
        <span class="section-title">Status</span>
        <div id="second">
            <!--<meter id='bat' style='height: 40px; width: 220px; top: 9px;' min='0' low='20' max='100'></meter>-->
            <div id='batt-container'>
                <div id="batt-gloss"></div>
                <div id="batt-fill"></div>
            </div>
            <meter style='height: 20px; left: 221px; top:23px; width: 5px;' min='2' max='8' value='0'></meter>
            <div2 style='color:#030;font-size:200%;top:25px;left:90px;text-shadow: -2px -2px 2px #efc;' id='SOC'></div2>

            <div class="button-container">
                <button onclick="dload('sbms.txt', localStorage['sbms']);">SAVE</button>
                <button onclick="localStorage.removeItem('sbms');localStorage['sbms'] ='';">CLEAR</button>
            </div>

            <div id="status-leds">
                <div id="led0">PV1 & PV2<div class="led led-yellow"></div></div>
                <div id="led2">BATTERY<div class="led led-yellow"></div></div>
                <div id="led1">LOAD<div class="led led-yellow"></div></div>
            </div>
        </div>
    </div>
    <div class="test2">
        <span class="section-title">Cells</span>
        <div id="third">
            <div class="largeBar">
                <div2 style='left:20px; color:#d00;' id='d2'></div2>
                <div2 style='left:115px; color: #00a9da;' id='d3'></div2>
                <div2 style='left:165px;color:#888;' id='d4'></div2>
                <div2 style='left:200px;' id='mt1'></div2>
            </div>
        </div>
    </div>

</div>


<div3>
    <div2 style='left:5px;color:#ea8;top:22px;' id='d6'></div2>
    <div2 style='right:530px;text-align: right;' id='d7'></div2>
    <div2 style='right:430px;text-align: right;' id='d8'></div2>
    <div2 style='right:220px;text-align: right;' id='d9'></div2>
    <div2 style='right:10px;text-align: right;' id='d10'></div2>
    <div5 style='width: 720px;top:0px;height:22px;text-align: right;' id='d11'></div5>
    <div4 id='mo0'>PV1 & PV2</div4>
    <div4 id='mo2' style='left:240px;'>Battery</div4>
    <div4 id='mo1' style='left:480px;'>Load</div4>
</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g0'></div12h>
    <div1h id='g1'></div1h>
    <div1m id='g2'></div1m>
    <div id='ch0' style='width: 360px;height: 135px;'></div>
</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g3'></div12h>
    <div1h id='g4'></div1h>
    <div1m id='g5'></div1m>
    <div id='ch1' style='width: 360px;height: 135px;'></div>
</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g6'></div12h>
    <div1h id='g7'></div1h>
    <div1m id='g8'></div1m>
    <div id='ch2' style='width: 360px;height: 135px;'></div>
</div3>

<script id='smain2'>
    all();

    function dload(n, t) {
        var pom = document.createElement('a');
        pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(t));
        pom.setAttribute('download', n);
        if (document.createEvent) {
            var event = document.createEvent('MouseEvents');
            event.initEvent('click', true, true);
            pom.dispatchEvent(event);
        }
        else {
            pom.click();
        }
    }

    //http://192.168.4.1/
</script>

<script id="dataScript" type="text/javascript"></script>
<!--<script type="text/javascript" src="http://192.168.4.1/"></script>-->


<script>
    let searchParams = new URLSearchParams(window.location.search);
    // searchParams.has('sent');
    let interval = parseInt(searchParams.get('interval'));

    var DATA_INTERVAL_OK = isNaN(interval) ? 2000 : interval;
    var DATA_INTERVAL_ERROR = 10000;
    var LOCAL_DEBUG = true;
    var counter = 1;

    function reset() {
        $('#d2, #d3, #d4, #d6, #d7, #d8, #d9, #d10, #d11, #d12, #mt1, #g0, #g1, #g2, #g3, #g4, #g5, #g6, #g7, #g8, #ch0, #ch1, #ch2').empty();
    }

    function getHslColor(value) {
        value = value / 100.0;
        //value from 0 to 1
        var hue = (value * 120).toString(10);
        return ['linear-gradient(hsl(', hue, ',90%,80%), hsl(', hue, ',90%,50%), hsl(', hue, ',90%,50%), hsl(', hue, ',90%,30%))'].join("");
        // return ["hsl(", hue, ",100%,50%)"].join("");
    }

    function parseData() {
        reset();
        sessionStorage['PV1'] = PV1;
        sessionStorage['PV2'] = PV2;
        sessionStorage['Batp'] = Btp;
        sessionStorage['Batn'] = Btn;
        sessionStorage['Ld'] = Ld;
        sessionStorage['ELd'] = ELd;

        localStorage['sbmsb'] = sbms;
        localStorage['xsbms'] = xsbms;
        localStorage['gsbms'] = gsbms;
        localStorage['eA'] = eA;
        localStorage['eW'] = eW;
        localStorage['cap'] = s1[0];
        localStorage['WA'] = s1[1];
        localStorage['model'] = s1[2];
        localStorage['sbms2'] = JSON.stringify(s2);
        localStorage['sbms'] = localStorage['sbms'] + sbms + '\n';

        all();
    }

    function startDataFetchTimer(miliseconds) {
        console.log(miliseconds);
        setTimeout(getData, miliseconds);
    }

    function getData() {
        var dataUrl = LOCAL_DEBUG ? "data" + counter + ".js" : "http://naturalborncamper.com/sandbox/SBMS/data" + counter + ".js";
        console.log(dataUrl);

        if (LOCAL_DEBUG) {
            $('#dataScript').off('ready load').remove();

            bob = document.body.appendChild(document.createElement('script'));
            bob.id = 'dataScript';
            $('#dataScript').on('load', function () {
                console.log('load');
                parseData();
                startDataFetchTimer(DATA_INTERVAL_OK);
                (counter < 5) ? ++counter : counter = 1;
            });
            bob.src = dataUrl;
        } else {
            $.getScript(dataUrl)
                .done(function (script, textStatus) {
                    parseData();
                    startDataFetchTimer(DATA_INTERVAL_OK);
                    console.log(textStatus);
                })
                .fail(function (jqxhr, settings, exception) {
                    startDataFetchTimer(DATA_INTERVAL_ERROR);
                    console.log("Triggered ajaxError handler.");
                })
                .always(function () {
                    (counter < 5) ? ++counter : counter = 1;
                });
        }
    }

    $(function () {
        startDataFetchTimer(0);
    })
</script>
</body>
</html>
