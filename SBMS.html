<!DOCTYPE html>
<html>
<head>
    <!--
        Background quadrillé bleu semi invisible (voir screenshots)
        Icones animés comme fans dans vidéo interface (pourrait démarrer/arrêter quand on les part)
        panels semi transparents avec bordure plus foncés et bouts arrondis + onglet pour titreàà
        Mouse pointer different
        Son menu system shock 2?
        data: Date + heure plus secondes plus GMT
        background dans chaque panneau, genre un outline d'une batterie
        temp int/ext avec thermomètre
        rollover sur boutons "save log"
        font lettres cadran

        panneaux comme dans panneaux.jpg
         barre de titre pareille
         lignes comme une règle dedans
        background panneaux comme dans advancedui__status_screen_by_z_design
        Titres avec autres boites comme "Processor Usage" "1" "3" dans futuristic-computer-screen-looping-animation_spkp1vjf__F0000

        Spinners
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948651
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948350
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948434
        https://www.dreamstime.com/stock-illustration-d-digital-hud-element-motion-nice-d-rendering-your-futuristic-project-image73948451

        Interfaces
        https://www.dreamstime.com/futuristic-user-menu-interface-hud-abstract-background-stock-illustration-image66155789
        https://www.dreamstime.com/stock-illustration-space-game-asset-vector-elements-strategy-video-image70671245
        https://www.dreamstime.com/stock-illustration-space-game-asset-vector-elements-video-image58652427

        Fonts
        LCD
        OSD
        Futuristic
        Digital
        HUD

    -->
    <title>ElectroDacus</title>
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <!--<meta http-equiv='refresh' content='3'>-->
    <link rel="stylesheet" href="SBMS.css"/>
    <link rel="stylesheet" href="marco.css"/>
    <link rel="icon" type="image/png" href="favicon.png"/>
    <style media='screen' type='text/css'></style>
    <script language="JavaScript" type="application/javascript" src="jquery-3.3.1.min.js"></script>
    <script language="JavaScript" type="application/javascript" src="all.js"></script>
</head>
<body>
<div3 style='height: 135px;'>
    <div2 style='display: none;' id='id'></div2>
    <div2 style='width:350px; top:82px; left:520px;'>
        <button onclick="dload('sbms.txt', localStorage['sbms']);">Save log</button>
        <button onclick="localStorage.removeItem('sbms');localStorage['sbms'] ='';">Clear log</button>
    </div2>

</div3>
<div3>
    <meter id='bat' style='height: 70px; width: 320px; top: 9px;' min='0' low='20' max='100'></meter>
    <meter style='height: 50px; left: 332px; top:18px; width: 15px;' min='2' max='8' value='0'></meter>
    <div2 style='color:#030;font-size:48px;top:35px;left:120px;text-shadow: -2px -2px 2px #efc;' id='SOC'></div2>
    <div2 style='left:5px;top:92px;color:#a99;line-height: 25px;' id='d12'></div2>
</div3>


<div3 id="small-panel">
    <div2 style='left:55px;color:#d00;' id='d2'></div2>
    <div2 style='left:150px; color: #00a9da;' id='d3'></div2>
    <div2 style='left:220px;color:#888;' id='d4'></div2>
    <div2 style='left:240px;' id='mt1'></div2>
</div3>


<div3>
    <div2 style='left:5px;color:#ea8;top:22px;' id='d6'></div2>
    <div2 style='right:530px;text-align: right;' id='d7'></div2>
    <div2 style='right:430px;text-align: right;' id='d8'></div2>
    <div2 style='right:220px;text-align: right;' id='d9'></div2>
    <div2 style='right:10px;text-align: right;' id='d10'></div2>
    <div5 style='width: 720px;top:0px;height:22px;text-align: right;' id='d11'></div5>
    <div4 id='mo0'>PV1 & PV2</div4>
    <div4 id='mo2' style='left:240px;'>Battery</div4>
    <div4 id='mo1' style='left:480px;'>Load</div4>

</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g0'></div12h>
    <div1h id='g1'></div1h>
    <div1m id='g2'></div1m>
    <div id='ch0' style='width: 360px;height: 135px;'></div>
</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g3'></div12h>
    <div1h id='g4'></div1h>
    <div1m id='g5'></div1m>
    <div id='ch1' style='width: 360px;height: 135px;'></div>
</div3>
<div3>
    <div style='background: #fb9;width: 720px;height:25px;'></div>
    <div12h id='g6'></div12h>
    <div1h id='g7'></div1h>
    <div1m id='g8'></div1m>
    <div id='ch2' style='width: 360px;height: 135px;'></div>
</div3>

<script id='smain2'>
    all();

    function dload(n, t) {
        var pom = document.createElement('a');
        pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(t));
        pom.setAttribute('download', n);
        if (document.createEvent) {
            var event = document.createEvent('MouseEvents');
            event.initEvent('click', true, true);
            pom.dispatchEvent(event);
        }
        else {
            pom.click();
        }
    }

    //http://192.168.4.1/
</script>

<script id="dataScript" type="text/javascript"></script>
<!--<script type="text/javascript" src="http://192.168.4.1/"></script>-->


<script>
    let searchParams = new URLSearchParams(window.location.search);
    // searchParams.has('sent');
    let interval = parseInt(searchParams.get('interval'));

    var DATA_INTERVAL_OK = isNaN(interval)? 2000: interval;
    var DATA_INTERVAL_ERROR = 10000;
    var LOCAL_DEBUG = true;
    var counter = 1;

    function reset() {
        $('#d2, #d3, #d4, #d6, #d7, #d8, #d9, #d10, #d11, #d12, #mt1, #g0, #g1, #g2, #g3, #g4, #g5, #g6, #g7, #g8, #ch0, #ch1, #ch2').empty();
    }

    function parseData() {
        reset();
        sessionStorage['PV1'] = PV1;
        sessionStorage['PV2'] = PV2;
        sessionStorage['Batp'] = Btp;
        sessionStorage['Batn'] = Btn;
        sessionStorage['Ld'] = Ld;
        sessionStorage['ELd'] = ELd;

        localStorage['sbmsb'] = sbms;
        localStorage['xsbms'] = xsbms;
        localStorage['gsbms'] = gsbms;
        localStorage['eA'] = eA;
        localStorage['eW'] = eW;
        localStorage['cap'] = s1[0];
        localStorage['WA'] = s1[1];
        localStorage['model'] = s1[2];
        localStorage['sbms2'] = JSON.stringify(s2);
        localStorage['sbms'] = localStorage['sbms'] + sbms + '\n';

        all();
    }

    function startDataFetchTimer(miliseconds) {
        console.log(miliseconds);
        setTimeout(getData, miliseconds);
    }

    function getData() {
        var dataUrl = LOCAL_DEBUG ? "data" + counter + ".js" : "http://naturalborncamper.com/sandbox/SBMS/data" + counter + ".js";
        console.log(dataUrl);

        if (LOCAL_DEBUG) {
            $('#dataScript').off('ready load').remove();

            bob = document.body.appendChild(document.createElement('script'));
            bob.id = 'dataScript';
            $('#dataScript').on('load', function () {
                console.log('load');
                parseData();
                startDataFetchTimer(DATA_INTERVAL_OK);
                (counter < 5) ? ++counter : counter = 1;
            });
            bob.src = dataUrl;
        } else {
            $.getScript(dataUrl)
                .done(function (script, textStatus) {
                    parseData();
                    startDataFetchTimer(DATA_INTERVAL_OK);
                    console.log(textStatus);
                })
                .fail(function (jqxhr, settings, exception) {
                    startDataFetchTimer(DATA_INTERVAL_ERROR);
                    console.log("Triggered ajaxError handler.");
                })
                .always(function () {
                    (counter < 5) ? ++counter : counter = 1;
                });
        }
    }

    $(function () {
        startDataFetchTimer(0);
    })
</script>
</body>
</html>
